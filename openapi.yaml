openapi: 3.1.1
info:
  title: Better Auth Invite Plugin API
  description: |
    OpenAPI schema for the Better Auth Invite Plugin.

    This plugin adds invitation-based onboarding flows on top of Better Auth.
  version: 1.0.0
  license:
    name: MIT

servers:
  - url: http://localhost:3000

tags:
  - name: Invites
    description: Invitation creation and activation flows

paths:
  /invite/create:
    post:
      tags: [Invites]
      summary: Create an invitation
      operationId: createInvite
      description: Create an invitation.
      security:
        - sessionAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateInviteBody"
      responses:
        "200":
          description: Success
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BasicSuccessResponse"

  /invite/activate:
    post:
      tags: [Invites]
      summary: Activate an invitation
      operationId: activateInvite
      description: Redirects the user to the callback URL with the token in a cookie.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                callbackURL:
                  type: string
                  description: Where to redirect the user after sign in/up
                  example: "https://example.com/dashboard"
                token:
                  type: string
                  description: The invite token
                  example: "inv_1234567890"
              required: [callbackURL, token]
      responses:
        "200":
          description: Invite activated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Invite activated successfully
                  action:
                    type: string
                    example: SIGN_IN_UP_REQUIRED
                  redirectTo:
                    type: string
                    example: /auth/sign-in
                required: [status, message]
        "400":
          description: Invalid or expired invite token
          content:
            application/json:
              schema:
                type: object
                properties:
                  errorCode:
                    type: string
                    example: INVALID_TOKEN
                  message:
                    type: string
                    example: Invalid or expired invite token
                required: [errorCode, message]
        "500":
          description: Internal server error

  /invite/{token}:
    get:
      tags: [Invites]
      summary: Invite activation callback
      operationId: activateInviteCallback
      description: |
        Redirects the user to the callback URL with the token in a cookie.

        If an error occurs, the user is redirected to the callback URL with the
        query parameters `error` and `message`.
      parameters:
        - name: token
          in: path
          required: true
          description: The invitation token
          schema:
            type: string
        - name: callbackURL
          in: query
          required: true
          description: Where to redirect the user after sign in/up
          schema:
            type: string
      responses:
        "302":
          description: Redirects the user to the callback URL.
          headers:
            Location:
              description: Redirect destination
              schema:
                type: string

components:
  securitySchemes:
    sessionAuth:
      type: apiKey
      in: cookie
      name: better-auth.session
      description: Session cookie used by Better Auth

  schemas:
    CreateInviteBody:
      type: object
      description: Request body for creating an invite
      properties:
        role:
          type: string
          description: The role to give the invited user.
          example: member

        email:
          type: string
          format: email
          description: The email address of the user to send a invitation email to.
          example: user@example.com
          nullable: true

        tokenType:
          type: string
          description: Type of token to use, 24 character token, 6 digit code or custom options.generateToken.
          enum:
            - token
            - code
            - custom
          nullable: true

        redirectToSignUp:
          type: string
          description: The URL to redirect the user to create their account. If invalid/expired -> ?error=INVALID_TOKEN, if valid -> ?token=VALID_TOKEN.
          example: /auth/sign-up
          nullable: true

        redirectToSignIn:
          type: string
          description: The URL to redirect the user to upgrade their role.
          example: /auth/sign-in
          nullable: true

        maxUses:
          type: number
          description: The number of times an invitation can be used.
          example: 1
          nullable: true

        expiresIn:
          type: number
          description: Number of seconds the invitation token is valid for.
          example: 86400
          nullable: true

        redirectToAfterUpgrade:
          type: string
          description: The URL to redirect the user to after upgrade their role (if the user is already logged in).
          example: /dashboard
          nullable: true

        shareInviterName:
          type: boolean
          description: Whether the inviter's name should be shared with the invitee.
          example: true
          nullable: true

        senderResponse:
          type: string
          description: How should the sender receive the token (sender only receives a token if no email is provided).
          enum: [token, url]
          nullable: true

        senderResponseRedirect:
          type: string
          description: Where should we redirect the user? (only if no email is provided).
          enum: [signUp, signIn]
          nullable: true

      required:
        - role

    BasicSuccessResponse:
      type: object
      properties:
        status:
          type: boolean
          example: true
        message:
          type: string
          example: Success
      required: [status, message]
